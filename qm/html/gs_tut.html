<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QM: QM Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="spexy-awesome.css" rel="stylesheet" type="text/css"/>
<link href="qm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.webp"/></a>
  </div>
   <div id="projectname">
    QM
    &nbsp;<span id="projectnumber">7.0.1</span>
   </div>
   <div id="projectbrief">Model-Based Design Tool</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('gs_tut.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">QM Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span class="prev_button"><a class="el" href="gs_run.html">Launching QM</a></span><span class="next_button"><a class="el" href="gs_exa.html">QM Examples</a></span> </p>
<p>This tutorial describes how to use QM to model and implement a simple "Blinky" application, which can blink an LED on an embedded board or just print the state changes of the LED to the screen when executed on the desktop. </p>
<dl class="section note"><dt>Note</dt><dd>This tutorial assumes <a href="https://www.state-machine.com/qpc" target="_blank" rel="noopener">QP/C&uarr;</a> (version <b>6</b> or higher). To work with other QP Framework types (e.g., <a href="https://www.state-machine.com/qpcpp" target="_blank" rel="noopener">QP/C++&uarr;</a>) it is recommended to create your Blinky model from a <b>model template</b> for the specific framework type, as <a class="el" href="#gs_tut_template">described below</a>.</dd></dl>
<h1><a class="anchor" id="gs_tut_video"></a>
QM Tutorial Video</h1>
<p>If you prefer to watch the <a href="https://youtu.be/VJpTJaGPrVk"><b>video version of this tutorial</b></a>, it is available on the <a href="https://www.youtube.com/c/StateMachineCOM">Quantum Leaps YouTube Channel</a>:</p>
<div class="image">
<img src="qm_tut_video.jpg" alt=""/>
<div class="caption">
Watch QM Tutorial video</div></div>
 <h1><a class="anchor" id="gs_tut_new"></a>
Creating A New Model from Scratch</h1>
<p>To create a new model, go to <span class="menu">File-&gt;New Model...</span> menu or press the <span class="img new_model">New Model</span> button in the <a class="el" href="ui_toolbars.html#ui_toolbar_edit">Edit Toolbar</a>. This will open the following <a class="el" href="ui_new-dlg.html">New Model Dialog Box</a> :</p>
<div class="image">
<img src="new_model.png" alt=""/>
<div class="caption">
New Model dialog</div></div>
    <ul>
<li>Select the <b>QP framework type</b> you want to base the new model on (the "Framework" panel). The choices are: <code>qpc</code> for QP/C and <code>qpcpp</code> for QP/C++. For this tutorial, leave the default <b>qpc</b> framework type.</li>
<li>Choose the <b>model template</b> for your model ("the Model Template" panel). , select the template and leave it at "None", your model will be empty, except the selected framework. For this tutorial, leave the default template <b>None</b>, so that you can start building your model from scratch.</li>
<li>Name your model (the "Name" field). <span class="highlight">NOTE: the <code>.qm</code> extension will be added automatically.</span> For this tutorial, rename the model to <code>blinky</code>.</li>
<li>Choose the directory for your model file (the "Location" field). You can either type in the path manually, or you can press the <span class="img search_folder">&#160;</span> button to open the directory-search dialog box. For this tutorial, choose the model location to <code>&lt;your-directory&gt;\blinky</code>, where <code>&lt;your-directory&gt;</code> is a directory of your choice. <span class="highlight">NOTE: the model directory also provides the reference point for code generation. All generated directories and files are relative to the model file directory.</span></li>
<li>Press the <span class="button">OK</span> button.</li>
<li>If you wish to build the model from scratch, skip the next section and proceed to <a class="el" href="#gs_tut_add">Adding Model Items</a>.</li>
</ul>
<h1><a class="anchor" id="gs_tut_template"></a>
Creating Blinky Model from Template</h1>
<p>Alternatively, you can create the Blinky model from the provided Template. As shown in the screen shot below, you select the <code>blinky.qm</code> Template in the New Model dialog:</p>
<div class="image">
<img src="new_blinky.png" alt=""/>
<div class="caption">
The Blinky template in New Model dialog</div></div>
    <p>When you close the dialog with the <span class="button">OK</span> button in this case, the blinky model will be copied from the provided template and will be ready. You can inspect the model, show the Blinky <a class="el" href="#gs_tut_draw">state diagram</a>, <a class="el" href="#gs_tut_ce-gen">generate code from it</a>, <a class="el" href="#gs_tut_build">build the application</a> and run it on your desktop PC.</p>
<dl class="section attention"><dt>Attention</dt><dd>The blinky model templates are available for all QP Framework types (QP/C and QP/C++), not just for QP/C. These model templates are a bit more advanced than the model you will create from scratch in the rest of this Tutorial. The models created from these templates are annotated with comments and documentation and it is <b>highly recommended</b> that you get familiar with the structure of these models.</dd></dl>
<h1><a class="anchor" id="gs_tut_add"></a>
Adding Model Items</h1>
<p>Now you can start adding items to the new model.</p>
<h2><a class="anchor" id="gs_tut_add-package"></a>
Add a Package</h2>
<p>The first item you add is a <a class="el" href="bm_package.html">Package</a>. A package in UML is a grouping construct that allows you to combine other model items into a higher-level unit&mdash;the package. The most common use of a package is to group together <a class="el" href="bm_class.html">classes</a>, but a package can hold also <a class="el" href="bm_attr.html">free attributes</a>, <a class="el" href="bm_oper-free.html">free operations</a>, and even other <a class="el" href="bm_package.html">packages</a>.</p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> view <b>right</b>-click on the <span class="img model">blinky</span> model item to get a popup-menu specific to that item. Once the popup menu opens, select <span class="menu">Add Package</span>.</li>
</ul>
<div class="image">
<img src="add_package.png" alt=""/>
<div class="caption">
Add Package</div></div>
    <ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the package name to <code>AOs</code> (Active Objects) and the stereotype to <code>components</code>.</li>
</ul>
<div class="image">
<img src="blinky_package.png" alt=""/>
<div class="caption">
Package Properties</div></div>
    <h2><a class="anchor" id="gs_tut_add-class"></a>
Add a Class</h2>
<p>Next you need to add a <a class="el" href="bm_class.html">class</a> to the new package, because only classes can have behavior (i.e., <a class="el" href="sm.html">State Machines</a>).</p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> view <b>right</b>-click on the <span class="img package_comp">AOs</span> package and select <span class="menu">Add Class</span> from the popup menu.</li>
</ul>
<div class="image">
<img src="add_class.png" alt=""/>
<div class="caption">
Add Class</div></div>
    <ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the class name to <code>Blinky</code> and the superclass to <span class="highlight"><code>qpc::QActive</code></span>.</li>
</ul>
<div class="image">
<img src="blinky_class.png" alt=""/>
<div class="caption">
Setting Superclass</div></div>
    <dl class="section note"><dt>Note</dt><dd>In QM a State Machine can only be associated with a <a class="el" href="bm_class.html">class</a> that inherits one of the <a class="el" href="sm.html#sm_class">QP state machine classes</a>. The choice of the state machine superclass determines the <a class="el" href="sm.html#sm_class">state machine implementation strategy</a>.</dd></dl>
<h2><a class="anchor" id="gs_tut_add-timer"></a>
Add a Time Event</h2>
<p>Next, you need to add a <b>Time Event</b> attribute that will deliver the periodic stimulus to trigger blinking in your <code>Blinky</code> state machine.</p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>right</b>-click on the <span class="img class_active">Blinky</span> class and select <span class="menu">Add Attribute</span> from the popup menu.</li>
</ul>
<div class="image">
<img src="blinky_a1.png" alt=""/>
<div class="caption">
Adding Attribute</div></div>
    <ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the attribute name to <code>timeEvt</code>, the type to <code>qpc::QTimeEvt</code>, and visibility to <code>private</code>.</li>
</ul>
<div class="image">
<img src="blinky_a2.png" alt=""/>
<div class="caption">
Attribute Properties</div></div>
    <h2><a class="anchor" id="gs_tut_add-sm"></a>
Add State Machine</h2>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>right</b>-click on the <span class="img class_active">Blinky</span> class and select <span class="menu">Add State Machine</span> from the popup menu.</li>
</ul>
<div class="image">
<img src="blinky_sm_add.png" alt=""/>
<div class="caption">
Adding State Machine</div></div>
    <h1><a class="anchor" id="gs_tut_draw"></a>
Drawing State Machine Diagram</h1>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>right</b>-click on the <span class="img statechart">SM</span> (State Machine) item and select <span class="menu">Show Diagram</span> from the popup menu. Alternatively you can just <b>double</b>-click on the <span class="img statechart">SM</span> item to execute its <b>default action</b>, which is to show the diagram.</li>
</ul>
<div class="image">
<img src="blinky_sm_show.png" alt=""/>
<div class="caption">
Show State Machine Diagram</div></div>
    <h2><a class="anchor" id="gs_tut_draw-state"></a>
Add States</h2>
<ul>
<li>In the <a class="el" href="ui_toolbox.html">Diagram Toolbox</a> click on the <span class="img state">state</span> tool. Move your mouse (all mouse buttons released) to the diagram window where you want to position the upper-left corner of the state shape. Notice the new shape of the mouse cursor (shown on the right). Click the mouse and drag it (with mouse button depressed) to the location of the lower-right corner of the state shape. Release the mouse.</li>
</ul>
<div class="image">
<img src="blinky_state_add.gif" alt=""/>
<div class="caption">
Adding the off State</div></div>
    <ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the state name to <code>off</code> and add the entry action to this state <code>BSP_ledOff();</code>.</li>
<li>In a similar way as before add a second state. In the <a class="el" href="ui_prop.html">Property Editor</a> change the state name to <code>on</code> and add the entry action to this state <code>BSP_ledOn();</code>.</li>
</ul>
<h2><a class="anchor" id="gs_tut_draw-initial"></a>
Add Initial Transition</h2>
<ul>
<li>In the <a class="el" href="ui_toolbox.html">Diagram Toolbox</a> click on the <span class="img initial"></span> initial transition tool. Move your mouse (all mouse buttons released) to the diagram window where you want to position the beginning of the initial transition shape. Notice the new shape of the mouse cursor (shown on the right). Click the mouse and drag it (with mouse button depressed) to the edge of the state. Notice the cursor change when you reach the edge. Release the mouse.</li>
</ul>
<div class="image">
<img src="blinky_init_add.gif" alt=""/>
<div class="caption">
Adding the Initial Transition</div></div>
    <ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> add action code to this initial transition <code>QTimeEvt_armX(&amp;me-&gt;timeEvt, BSP_TICKS_PER_SEC/2, BSP_TICKS_PER_SEC/2);</code></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The action code of the initial transition arms the time event to expire in <code>BSP_TICKS_PER_SEC/2</code> number of clock ticks (i.e., in 1/2 of a second) and also <b>every</b> <code>BSP_TICKS_PER_SEC/2</code> number of clock ticks (i.e., every 1/2 of a second).</dd></dl>
<h2><a class="anchor" id="gs_tut_draw-tran"></a>
Add Transitions</h2>
<ul>
<li>In the <a class="el" href="ui_toolbox.html">Diagram Toolbox</a> click on the <span class="img tran"></span> transition tool. Move your mouse (all mouse buttons released) to the state edge where you want to position the beginning of the transition connector. Notice the new shape of the mouse cursor (<span class="img cur_tran1"></span>). Click the mouse and drag it (with mouse button depressed) to the edge of the state. Notice the cursor change when you reach the edge. Release the mouse.</li>
</ul>
<div class="image">
<img src="blinky_tran_add.gif" alt=""/>
<div class="caption">
Adding a Transition</div></div>
    <ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the trigger of this transition to <code>TIMEOUT</code>.</li>
<li>In a similar way as before add a second transition and change its trigger also to <code>TIMEOUT</code>.</li>
</ul>
<div class="image">
<img src="blinky_sm.png" alt=""/>
<div class="caption">
Complete State Machine</div></div>
    <h1><a class="anchor" id="gs_tut_ce"></a>
Engineering the Code</h1>
<p>Compared to most other graphical tools based on state machines, QM turns the code generation "upside down". QM lets <b>you</b> determine the generated code structure, directory names, file names, and elements that go into every file (see <a class="el" href="ce.html#ce_phys">Physical Design</a>). You can mix your own code with the generated code and use QM to generate as much or as little of the overall code as you see fit .</p>
<h2><a class="anchor" id="gs_tut_ce-dir"></a>
Add Directory</h2>
<p>First, you need to create a <a class="el" href="ce_dir.html">directory</a>, which will determine the location of the files generated on disk <b>relative</b> to the <a class="el" href="ui_model_file.html">QM Model File</a>.</p>
<div class="image">
<img src="blinky_dir_add.gif" alt=""/>
<div class="caption">
Adding a Directory</div></div>
    <ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>right</b>-click on the <span class="img model">blinky</span> model item and select <span class="menu">Add Directory</span> in the popup menu. This will be the <a class="el" href="ce_dir.html">directory</a> where your code will be generated. The <b>path</b> of the directory <b>relative</b> to the <a class="el" href="ui_model_file.html">QM Model File</a> can be edited in the Property Editor. Type <code>.</code> (dot) for the name of the directory. The dot means the same directory as the <a class="el" href="ui_model_file.html">QM Model File</a>, meaning that your code will be generated in the same directory as your model.</li>
</ul>
<h2><a class="anchor" id="gs_tut_ce-file"></a>
Add File</h2>
<p>Once you have a directory, you can add <a class="el" href="ce_file.html">Files</a> to it. In a real-life project you would typically split the code into header (<code>.h</code>) files, place each active object in its own source (<code>.c</code>) file, and use separate <code>.c</code> files for the Board Support Package (BSP) and <code>main()</code>. But for the sake of simplicity, this tutorial will put the whole implementation in just one file: <code>blinky.c</code>, which you create as follows:</p>
<div class="image">
<img src="blinky_file_add.gif" alt=""/>
<div class="caption">
Adding a File</div></div>
    <ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> view <b>right</b>-click on the <span class="img directory">.</span> directory item and select <span class="menu">Add File</span> in the popup menu. After the file is created, you can edit its name in the Property Editor. Type <code>blinky.c</code> in the name box and press Enter. Note that the file icon changes to <span class="img file_source_c">&#160;</span>.</li>
</ul>
<h2><a class="anchor" id="gs_tut_ce-code"></a>
Edit File</h2>
<p>In QM <b>you</b> provide the body of every <a class="el" href="ce_file.html">file-template</a>, in which you can type your own code as well as <a class="el" href="ce_gen.html">Code Generation</a>.</p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>double</b>-click on the <span class="img file_c">blinky.c</span> file to open the file in a window. Next copy the following code to the Clipboard and paste it into the file window.</li>
</ul>
<div class="caption"><center><em>file blinky.c</em></center></div> <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;qpc.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span> <span class="comment">// for exit()</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//Q_DEFINE_THIS_FILE</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> BlinkySignals {</div>
<div class="line">    TIMEOUT_SIG = Q_USER_SIG,</div>
<div class="line">    MAX_SIG</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> { BSP_TICKS_PER_SEC = 100 };</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> BSP_ledOff(<span class="keywordtype">void</span>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;LED OFF\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> BSP_ledOn(<span class="keywordtype">void</span>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;LED ON\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> Q_onError(<span class="keywordtype">char</span> <span class="keyword">const</span> * <span class="keyword">const</span> module, <span class="keywordtype">int</span> loc) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Assertion failed in %s:%d&quot;</span>, module, loc);</div>
<div class="line">    exit(-1);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> QF_onStartup(<span class="keywordtype">void</span>) {}</div>
<div class="line"><span class="keywordtype">void</span> QF_onCleanup(<span class="keywordtype">void</span>) {}</div>
<div class="line"><span class="keywordtype">void</span> QF_onClockTick(<span class="keywordtype">void</span>) {</div>
<div class="line">    QTIMEEVT_TICK_X(0U, (<span class="keywordtype">void</span> *)0);  <span class="comment">// time-event clock tick processing</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> QActive * <span class="keyword">const</span> AO_Blinky;</div>
<div class="line"><span class="keywordtype">void</span> Blinky_ctor(<span class="keywordtype">void</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    QF_init(); <span class="comment">// initialize the framework</span></div>
<div class="line"> </div>
<div class="line">    Blinky_ctor(); <span class="comment">// explicitly call the &quot;constructor&quot;</span></div>
<div class="line">    <span class="keyword">static</span> QEvtPtr blinky_queueSto[10];</div>
<div class="line">    QActive_start(AO_Blinky,    <span class="comment">// Active Object pointer</span></div>
<div class="line">        1U,                     <span class="comment">// priority</span></div>
<div class="line">        blinky_queueSto,        <span class="comment">// queue buffer</span></div>
<div class="line">        Q_DIM(blinky_queueSto), <span class="comment">// queue buffer length [QEvtPtr units]</span></div>
<div class="line">        (<span class="keywordtype">void</span> *)0, 0U,          <span class="comment">// no private stack</span></div>
<div class="line">        (QEvt *)0);             <span class="comment">// no initialization event</span></div>
<div class="line">    <span class="keywordflow">return</span> QF_run(); <span class="comment">// run the QF application (doesn&#39;t return until done)</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//================== ask QM to declare the Blinky class ======================</span></div>
<div class="line">$declare${AOs::Blinky}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> Blinky l_blinky;</div>
<div class="line">QActive * <span class="keyword">const</span> AO_Blinky = &amp;l_blinky.super;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Blinky_ctor(<span class="keywordtype">void</span>) {</div>
<div class="line">    Blinky *me = (Blinky *)AO_Blinky;</div>
<div class="line">    QActive_ctor(&amp;me-&gt;super, Q_STATE_CAST(&amp;Blinky_initial));</div>
<div class="line">    QTimeEvt_ctorX(&amp;me-&gt;timeEvt, &amp;me-&gt;super, TIMEOUT_SIG, 0U);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//================== ask QM to define the Blinky class =======================</span></div>
<div class="line">$define${AOs::Blinky}</div>
</div><!-- fragment --><dl class="section attention"><dt>Attention</dt><dd>The listing above shows the two most important code generation directives: <a class="el" href="ce_declare.html">$declare${AOs::Blinky}</a> for generating the <a class="el" href="ce_gen.html#ce_gen-decl">Declaration</a> of the <code>Blinky</code> class, and <a class="el" href="ce_define.html">$define${AOs::Blinky}</a> for generating the <a class="el" href="ce_gen.html#ce_gen-def">Definition</a> of the of the <code>Blinky</code> class.<br  />
</dd></dl>
<div class="image">
<img src="blinky_file_edit.gif" alt=""/>
<div class="caption">
Opening blinky.c File and Pasting the Code</div></div>
    <h2><a class="anchor" id="gs_tut_ce-gen"></a>
Generate Code</h2>
<ul>
<li>Generate code by pressing the <span class="img codegen">Generate Code</span> button in the Tools toolbar.</li>
</ul>
<div class="image">
<img src="blinky_code_gen.gif" alt=""/>
<div class="caption">
Code Generation</div></div>
    <p>At this point QM has generated the <code>blinky.c</code> file in the same directory as the <code>blinky.qm</code> <a class="el" href="ui_model_file.html">QM Model File</a>. You can inspect the generated <code>blinky.c</code> file on the disk with your favorite code editor.</p>
<h1><a class="anchor" id="gs_tut_build"></a>
Building the Project</h1>
<p>To build the example, you need to combine the generated <code>blinky.c</code> source file with other files, not generated by QM, most notably the <code>qp_config.h</code> header file and QP/C framework source code. The following annotated directory listing explains the files needed to build the Blinky application:</p>
<div class="fragment"><div class="line">&lt;blinky&gt;           <span class="comment">// this project directory</span></div>
<div class="line">    blinky.c       <span class="comment">// source file generated by QM</span></div>
<div class="line">    qp_config.h    <span class="comment">// QP/C configuration file (YOU NEED TO DOWNLOAD!)</span></div>
<div class="line">    Makefile       <span class="comment">// Makefile to build the Blinky application (YOU NEED TO DOWNLOAD!)</span></div>
<div class="line">...</div>
<div class="line">&lt;qp&gt;               <span class="comment">// QP-bundle installation directory</span></div>
<div class="line">   +---qpc         <span class="comment">// QP/C framework directory</span></div>
<div class="line">       +---include</div>
<div class="line">       +---src</div>
<div class="line">       +---ports</div>
</div><!-- fragment --><h2><a class="anchor" id="gs_tut_dwnld"></a>
Downloading Additional Files</h2>
<p>Here are the additional files you need to download (from GitHub) and put in the Blinky project directory, as shown in the directory listing above:</p><ul>
<li><a href="https://github.com/QuantumLeaps/qpc-examples/blob/main/posix-win32/blinky/qp_config.h" target="_blank" rel="noopener">download qp_config.h from GitHub&uarr;</a></li>
</ul>
<p><a href="https://github.com/QuantumLeaps/qpc-examples/blob/main/posix-win32/blinky/qp_config.h" title="Download from GitHub" target="_blank"><div class="image">
<img src="blinky_qp_config.png" alt=""/>
</div>
 </a></p>
<ul>
<li><a href="https://github.com/QuantumLeaps/qpc-examples/blob/main/posix-win32/blinky/Makefile" target="_blank" rel="noopener">download Makefile from GitHub&uarr;</a></li>
</ul>
<p><a href="https://github.com/QuantumLeaps/qpc-examples/blob/main/posix-win32/blinky/Makefile" title="Download from GitHub" target="_blank"><div class="image">
<img src="blinky_makefile.png" alt=""/>
</div>
 </a></p>
<h2><a class="anchor" id="gs_tut_build-term"></a>
Building from the Terminal</h2>
<p>After downloading <code>qp_config.h</code> and <code>Makefile</code>, you invoke the <code>make</code> utility to build your Blinky executable, whereas you set the <code>QPC</code> variable to point to the location of the QP/C framework:</p>
<pre class="fragment">Windows:
make QPC=c:\qp\qpc

Linux, macOS:
make QPC=~/qp/qpc
</pre><dl class="section note"><dt>Note</dt><dd>On Windows, the free <code>make</code> utility and the <code>gcc</code> compiler aren't typically installed, so you need to download and install them. The <a href="https://github.com/QuantumLeaps/qtools/releases" target="_blank" rel="noopener">QTools collection for Windows&uarr;</a> contains the MinGW <code>gcc</code> compiler and other Unix-style utilities.</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>This section shows how to build the Blinky project from the command-prompt. However, it is also possible to build the project <a class="el" href="ui_tools-dlg.html#ui_tools-dlg_gcc">directly from QM</a>, by defining an external tool in the <a class="el" href="ui_tools-dlg.html">Manage Tools Dialog Box</a>.</dd></dl>
<h2><a class="anchor" id="gs_tut_build-run"></a>
Running Blinky in the Console</h2>
<p>Finally, you can run the produced Blinky executable, which starts printing to your screen. You exit the application by pressing <b>Ctrl+C</b>.</p>
<pre class="fragment">build\blinky
</pre><div class="image">
<img src="blinky_win.gif" alt=""/>
<div class="caption">
Blinky on Windows</div></div>
    <p>On Linux, you run the produced <code>blinky</code> file as follows. Again, you exit the application by pressing <span class="button">Ctrl+C</span>.</p>
<pre class="fragment">build/blinky
</pre><div class="image">
<img src="blinky_linux.gif" alt=""/>
<div class="caption">
Blinky on Linux</div></div>
    <p>You exit the application by pressing <span class="button">Ctrl+C</span>.</p>
<h2><a class="anchor" id="gs_tut_emb"></a>
Building Blinky for an Embedded Board</h2>
<p>To build the Blinky project for an embedded board, you need to modify the BSP (Board Support Package) to turn the LED on and off. You also need to use the specific cross-compiler. Please refer to the <a href="https://youtu.be/O7ER6_VqIH0" target="_blank" rel="noopener">"Getting Started" video&uarr;</a> for more information about getting started with the QP Frameworks. Also, you might read "Getting Started" Application Notes: <a href="https://www.state-machine.com/doc/AN_Getting_Started_with_QPC.pdf" target="_blank" rel="noopener">QP/C&uarr;</a> and <a href="https://www.state-machine.com/doc/AN_Getting_Started_with_QPCpp.pdf" target="_blank" rel="noopener">QP/C++&uarr;</a>.</p>
<div class="image">
<img src="blinky_ek-tm4c123gxl.gif" alt=""/>
<div class="caption">
Blinky on TivaC LaunchPad</div></div>
    <p><span class="prev_button"><a class="el" href="gs_run.html">Launching QM</a></span><span class="next_button"><a class="el" href="gs_exa.html">QM Examples</a></span>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="gs.html">Getting Started</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2025 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QM 7.0.1</b> &nbsp;|&nbsp; created with <a title="Spexygen: traceable specifications" href="https://github.com/QuantumLeaps/spexygen"><em>Spexygen</em></a>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2025 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QM 7.0.1</b> &nbsp;|&nbsp; created with <a title="Spexygen: traceable specifications" href="https://github.com/QuantumLeaps/spexygen"><em>Spexygen</em></a>
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
